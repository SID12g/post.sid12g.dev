---
title: TanStack Query ì•Œì•„ë³´ê¸°
date: "2024-08-10"
description: TanStack Queryì˜ íŠ¹ì§•ê³¼ ì‚¬ìš©í•˜ëŠ” ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.
image: /contents/tech/tanstack-query/thumbnail.png
tag: React
---

> ì´ ê¸€ì€ TanStack Query v5ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

## Contents

## TanStack Queryë€?

TanStack QueryëŠ” fetching, caching, synchronizing, updating ë“±ì„ ì§€ì›í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.

ì¦‰ ì„œë²„ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ëŒ€í‘œì ìœ¼ë¡œ TanStack Queryì™€ SWRì´ ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ê´€ë¦¬í•˜ê¸° ì–´ë ¤ì› ë˜ ë¹„ë™ê¸° ë°ì´í„°, ì„œë²„ ìƒíƒœ ë“±ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## TanStack Query ì„¤ì¹˜í•˜ê¸°

React í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•œ ë’¤ ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ TanStack Queryë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
yarn add @tanstack/react-query
```

ì„¤ì¹˜ ì´í›„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ QueryClientProviderë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¸ì£¼ì„¸ìš”. QueryClientProviderëŠ” context apië¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì—¬ ë°ì´í„°ë¥¼ ì „ì—­ì— ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤ë‹ˆë‹¤.

```tsx
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

const queryClient = new QueryClient();

export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Example />
    </QueryClientProvider>
  );
}
```

Reactê°€ ì•„ë‹Œ ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ [ê³µì‹ ë¬¸ì„œ](https://tanstack.com/query/latest/docs/framework/react/installation)ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.

## Caching

Cachingì´ë€ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¨ ë’¤ì— ì„ì‹œë¡œ ì €ì¥í•˜ì—¬ ë³´ë‹¤ ë¹ ë¥´ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤.

ì•ì„œ ë§í–ˆë“¯ TanStack QueryëŠ” ë°ì´í„°ë¥¼ Cachingí•©ë‹ˆë‹¤. ì •í•´ì§„ cacheTime (ê¸°ë³¸ ê°’ì€ 5ë¶„ì…ë‹ˆë‹¤.) ë§Œí¼ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ Cacheê°€ ì¡´ì¬í•œë‹¤ê³  í•´ì„œ data fetchingì„ í•˜ì§€ ì•ŠëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. cacheTimeì´ ì§€ë‚˜ì§€ ì•Šì•˜ì§€ë§Œ í•´ë‹¹ ë°ì´í„°ë¥¼ í•„ìš”ë¡œí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ mountë˜ë©´ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ fetchingí•˜ëŠ” ë™ì•ˆ Cachingëœ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

```tsx
const MINUTE = 1000 * 60;

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      gcTime: 10 * MINUTE,
    },
  },
});
```

ìœ„ì™€ ê°™ì´ [queryClient](https://tanstack.com/query/latest/docs/reference/QueryClient#queryclient)ì—ì„œ (í˜¹ì€ [queryOptions](https://tanstack.com/query/latest/docs/framework/react/guides/query-options#query-options)ì—ì„œ) [gcTime](https://tanstack.com/query/latest/docs/framework/react/guides/migrating-to-v5#rename-cachetime-to-gctime) (cacheTimeì—ì„œ gcTimeìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.) ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Fresh and Stale

ì´ë²ˆì—ëŠ” Freshì™€ Staleì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. ë°ì´í„°ì— ìƒíƒœëŠ” Freshì™€ Staleë¡œ ë‚˜ë‰©ë‹ˆë‹¤. FreshëŠ” ì˜ë¯¸ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´ ë°ì´í„°ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‹ ì„ í•œ ìƒíƒœë¼ëŠ” ëœ» ì…ë‹ˆë‹¤. Stale ë˜í•œ ì˜ë¯¸ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´ ë°ì´í„°ê°€ refetchingì´ í•„ìš”í•  ë§Œí¼ ì‹ ì„ í•˜ì§€ ëª»í•œ ìƒíƒœë¼ëŠ” ëœ» ì…ë‹ˆë‹¤. ë°ì´í„°ëŠ” ì´ˆê¸°ì— Fresh ìƒíƒœì˜€ë‹¤ê°€ staleTime (ê¸°ë³¸ ê°’ì€ 0ì…ë‹ˆë‹¤.) ì´í›„ Stale ìƒíƒœê°€ ë©ë‹ˆë‹¤.

```tsx
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: Infinity,
    },
  },
});
```

ìœ„ì™€ ê°™ì´ [queryClient](https://tanstack.com/query/latest/docs/reference/QueryClient#queryclient)ì—ì„œ (í˜¹ì€ [queryOptions](https://tanstack.com/query/latest/docs/framework/react/guides/query-options#query-options)ì—ì„œ) staleTimeì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## useQuery

FetchëŠ” ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆëŠ” APIì…ë‹ˆë‹¤. ì›ë˜ Fetch APIë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

```jsx
async function fetchData() {
  const response = await fetch("http://example.com/movies.json");
  const data = await response.json();
  console.log(data);
}
```

ì•„ë˜ëŠ” TanStack Queryì˜ useQueryë¥¼ ì‚¬ìš©í•œ ê²½ìš°ì…ë‹ˆë‹¤.

```tsx
import {
  QueryClient,
  QueryClientProvider,
  useQuery,
} from "@tanstack/react-query";

const queryClient = new QueryClient();

export default function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <Example />
    </QueryClientProvider>
  );
}

function Example() {
  const { isPending, error, data } = useQuery({
    queryKey: ["repoData"],
    queryFn: () =>
      fetch("https://api.github.com/repos/TanStack/query").then((res) =>
        res.json()
      ),
  });

  if (isPending) return "Loading...";

  if (error) return "An error has occurred: " + error.message;

  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>ğŸ‘€ {data.subscribers_count}</strong>{" "}
      <strong>âœ¨ {data.stargazers_count}</strong>{" "}
      <strong>ğŸ´ {data.forks_count}</strong>
    </div>
  );
}
```

![useQuery ì‚¬ìš©](/contents/tech/tanstack-query/isPending.gif) _useQuery ì‚¬ìš© ì‹œ isPendingìœ¼ë¡œ ë¡œë”© ì¤‘ì¸ì§€ í™•ì¸_

TanStack Queryì˜ ê²½ìš°ì—ëŠ” [useQuery](https://tanstack.com/query/latest/docs/framework/react/reference/useQuery#usequery) (GET), [useMutation](https://tanstack.com/query/v5/docs/framework/react/reference/useMutation) (POST, PUT, UPDATE, DELETE) ë“±ì„ ì‚¬ìš©í•˜ì—¬ fetchë¥¼ í•˜ê²Œ ë©ë‹ˆë‹¤. useQueryì˜ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ queryKeyì— Cachingì— í•„ìš”í•œ ì¿¼ë¦¬ í‚¤ë¥¼ ì…ë ¥ë°›ê³ , queryFnì— ê¸°ë³¸ fetch í•¨ìˆ˜ë¥¼ ì…ë ¥ë°›ìŠµë‹ˆë‹¤.

ë˜í•œ ê²°ê³¼ ê°’ìœ¼ë¡œ isPending, error, data ë“± ì—¬ëŸ¬ê°€ì§€ ì˜µì…˜ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ”ë°, isPendingì˜ ê²½ìš° dataê°€ ë¶ˆëŸ¬ì™€ ì§€ê³  ìˆëŠ”ì§€ (ë¡œë”© ì¤‘ì¸ì§€)ë¥¼ ì•Œ ìˆ˜ ìˆê³ , errorëŠ” dataë¥¼ ê°€ì ¸ì˜¤ëŠ” ê³¼ì •ì—ì„œ ë°œìƒí•œ errorë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë§Œì•½ fetchì— ëŒ€í•´ ë” ì•Œì•„ë³´ê³  ì‹¶ë‹¤ë©´ [mdn web docs](https://developer.mozilla.org/ko/docs/Web/API/Fetch_API/Using_Fetch)ë¥¼ í™•ì¸í•˜ê³  useQueryì˜ ë” ìì„¸í•œ ì…ë ¥, ê²°ê³¼ ê°’ë“¤ì„ í™•ì¸í•˜ê³  ì‹¶ë‹¤ë©´ [useQuery](https://tanstack.com/query/latest/docs/framework/react/reference/useQuery#usequery)ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.

## useQueries

[useQueries](https://tanstack.com/query/latest/docs/framework/react/reference/useQueries)ëŠ” ì—¬ëŸ¬ê°œì˜ queryë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
const ids = [1, 2, 3];
const results = useQueries({
  queries: ids.map((id) => ({
    queryKey: ["post", id],
    queryFn: () => fetchPost(id),
    staleTime: Infinity,
  })),
});
```

ìš”ì²­ì„ í•˜ë©´ ë°°ì—´ë¡œ ê²°ê³¼ê°€ ë°˜í™˜ë©ë‹ˆë‹¤.

## useSuspenseQuery

ì•ì„œ useQueryì˜ isPendingì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ê°€ ë¡œë”© ì¤‘ì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ isPendingì´ ì•„ë‹Œ Suspenseë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì€ ê²½ìš°, [useSuspenseQuery](https://tanstack.com/query/latest/docs/framework/react/reference/useSuspenseQuery)ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

```tsx
import { useSuspenseQuery } from "@tanstack/react-query";
import { Suspense } from "react";

export function Example() {
  return (
    <Suspense fallback={<Loading />}>
      <DataComponent />
    </Suspense>
  );
}

function Loading() {
  return <p>Loading...</p>;
}

function DataComponent() {
  const { data, error } = useSuspenseQuery({
    queryKey: ["repoData"],
    queryFn: () =>
      fetch("https://api.github.com/repos/TanStack/query").then((res) =>
        res.json()
      ),
  });

  if (error) return error.message;

  return (
    <div>
      <h1>{data.name}</h1>
      <p>{data.description}</p>
      <strong>ğŸ‘€ {data.subscribers_count}</strong>
      <strong>âœ¨ {data.stargazers_count}</strong>
      <strong>ğŸ´ {data.forks_count}</strong>
    </div>
  );
}
```

## ë§ˆë¬´ë¦¬

í˜¹ì‹œ TanStack Queryë¡œ GETìš”ì²­ì´ ì•„ë‹Œ POST, PUT, UPDATE, DELETE ë“±ì˜ ìš”ì²­ì„ ë³´ë‚´ê³  ì‹¶ë‹¤ë©´, [useMutation](https://tanstack.com/query/v5/docs/framework/react/reference/useMutation)ì— ëŒ€í•´ ì•Œì•„ë³´ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

ì‚¬ì‹¤ ìœ„ì— ì„¤ëª…í•œ ë‚´ìš©ë§Œìœ¼ë¡œëŠ” TanStack Queryë¥¼ ëª¨ë‘ ì´í•´í–ˆë‹¤ê³  í•˜ê¸°ëŠ” ì–´ë µìŠµë‹ˆë‹¤. ì €ë„ TanStack Queryë¥¼ ê³µë¶€í•˜ê³  ì´ ê¸€ì„ ì“°ë©´ì„œ ì–´ë–»ê²Œ ê¸€ì„ ì¨ì•¼í• ì§€ ë§ì´ ê³ ë¯¼í•´ ë³´ì•˜ì§€ë§Œ ìµœëŒ€í•œ ê°„ê²°í•˜ê²Œ ì“°ê³  ë‹¤ì–‘í•œ ì•„í‹°í´ì„ ì½ì–´ë³´ëŠ”ê²Œ ì¢‹ì„ ê²ƒ ê°™ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

ì´ ê¸€ì„ ì½ê³  ê³„ì‹œëŠ” ë¶„ë“¤ë„ [ê³µì‹ë¬¸ì„œ](https://tanstack.com/query/latest/docs/framework/react/overview)ë¥¼ ë¹„ë¡¯í•´ [TanStack Queryì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì„¤ëª…í•œ ê¸€](https://www.timegambit.com/blog/digging/react-query/01), [ì¹´ì¹´ì˜¤í˜ì´](https://tech.kakaopay.com/post/react-query-1/), [ìš°ì•„í•œí˜•ì œë“¤](https://www.youtube.com/watch?v=nkXIpGjVxWU&t=1081s) ë“± ì—¬ëŸ¬ ê¸°ì—…ì´ TanStack Queryë¥¼ ë„ì…í•œ ê³„ê¸°ì™€ [ë§ì€ ê°œë°œìë“¤ì´ ë¸”ë¡œê·¸ì— ì‘ì„±í•œ ê¸€](https://www.google.com/search?q=TanStack+Query&oq=TanStack+Query&gs_lcrp=EgZjaHJvbWUyDggAEEUYJxg5GIAEGIoFMgwIARAjGCcYgAQYigUyBggCEEUYOzIGCAMQRRg7MgYIBBBFGDsyDAgFEAAYQxiABBiKBTIGCAYQRRg8MgYIBxBFGDzSAQgyODAwajBqN6gCALACAA&sourceid=chrome&ie=UTF-8) ë“± ìˆ˜ ë§ì€ ê¸€ë“¤ì„ ì°¾ì•„ ì½ì–´ë³´ì…¨ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.

ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.
