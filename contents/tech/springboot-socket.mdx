---
title: Spring Bootë¥¼ ì‚¬ìš©í•˜ì—¬ ì±„íŒ… ì„œë¹„ìŠ¤ ë§Œë“¤ê¸°
date: "2025-03-17"
description: Spring Bootì™€ Socketì„ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•œ ì±„íŒ… ì˜ˆì œë¥¼ êµ¬í˜„í•´ë´…ë‹ˆë‹¤.
image: /contents/tech/springboot-socket/thumbnail.webp
tag: Spring Boot
---

> í•´ë‹¹ í¬ìŠ¤íŠ¸ëŠ” í•œêµ­ë””ì§€í„¸ë¯¸ë””ì–´ê³ ë“±í•™êµ ê³µì—…ì¼ë°˜ í”„ë¡œì íŠ¸ ìˆ˜í–‰í‰ê°€ë¥¼ ëª©ì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. [ìê¸°ê³„ë°œê³„íšì„œ í™•ì¸í•˜ê¸°](/contents/tech/springboot-socket/ìê¸°ê³„ë°œê³„íšì„œ.pdf)

## Contents

## Spring Boot í”„ë¡œì íŠ¸ ìƒì„±í•˜ê¸°

Spring Boot í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ì„  [spring initializr](https://start.spring.io/)ì— ì ‘ì†í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. ë³¸ í”„ë¡œì íŠ¸ëŠ” Java 17 ê¸°ë°˜ìœ¼ë¡œ ìƒì„±í•˜ì˜€ìœ¼ë©°, Spring BootëŠ” 3.4.3 ë²„ì „ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤. ì˜†ì— Dependenciesì—ì„œ ê°œë°œì— ì‚¬ìš©í•  dependencyë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆëŠ”ë°, ì €ëŠ” Lombok, Spring Boot DevTools, Spring Web ì´ë ‡ê²Œ 3ê°œë¥¼ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´, ì•„ë˜ Generate ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ìš´ë¡œë“œ í›„ InteliJë¡œ ì—´ì–´ì£¼ì„¸ìš”.

![spring initializr](/contents/tech/springboot-socket/init.webp) _spring initializr_

## Supabase Database ì—°ê²°í•˜ê¸°

ì±„íŒ… ì•±ì—ì„œ íšŒì› ì‹ë³„ê³¼ ì±„íŒ… ë‚´ìš© ì €ì¥ ë“±ì˜ ê¸°ëŠ¥ì„ ìœ„í•´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•œ í›„ ì—°ê²°í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ìš°ì„  Supbaseì— ì ‘ì†í•©ë‹ˆë‹¤.

![Supabase Dashboard](/contents/tech/springboot-socket/db-dash.webp) _Supabase Dashboard_

ê·¸ë¦¬ê³  ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì„œë²„ë¥¼ ê°€ê¹Œìš´ ê³³ìœ¼ë¡œ ì„ íƒí•˜ê³ , ë¹„ë°€ë²ˆí˜¸ëŠ” ê¸°ì–µí•´ë†“ì•„ì•¼ í•©ë‹ˆë‹¤.

![Supabase New Project](/contents/tech/springboot-socket/db-set.webp) _Supabase New Project_

ê·¸ë¦¬ê³  í”„ë¡œì íŠ¸ê°€ ìƒì„±ë˜ë©´ ì•„ë˜ì™€ ê°™ì€ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤. ì´ í˜ì´ì§€ê°€ ë°©ê¸ˆ ë§Œë“  í”„ë¡œì íŠ¸ì˜ ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤.

![Supabase Dashboard](/contents/tech/springboot-socket/db-home.webp) _Supabase Project Dashboard_

Databaseë¥¼ ìƒì„±í–ˆìœ¼ë‹ˆ, Spring Boot í”„ë¡œì íŠ¸ì—ì„œ ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

```java:build.gradle
implementation 'org.springframework.session:spring-session-jdbc'
implementation 'org.postgresql:postgresql'
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
implementation 'org.springframework.boot:spring-boot-starter-security'
```

ì²« ë²ˆì§¸ëŠ” Spring Session JDBC ì§€ì›ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. JDBC ê¸°ë°˜ ì„¸ì…˜ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ì…˜ ì •ë³´ë¥¼ RDBMS(PostgreSQL, MySQL ë“±)ì— ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‘ ë²ˆì§¸ëŠ” PostgreSQL ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. SupabaseëŠ” PostgreSQLì„ ê¸°ë°˜ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ì„œë¹„ìŠ¤ì´ê¸° ë•Œë¬¸ì—, PostgreSQL ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

ì„¸ ë²ˆì§¸ëŠ” Spring Data JPA ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. JPAë¥¼ í†µí•´ ë¦¬í¬ì§€í† ë¦¬, íŠ¸ëœì­ì…˜ ê´€ë¦¬, ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ë“±ì„ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë„¤ ë²ˆì§¸ëŠ” Spring Security ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. Spring Securityë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦, ê¶Œí•œ ë¶€ì—¬, ë³´ì•ˆ ì„¤ì • ë“±ì„ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![build gradle](/contents/tech/springboot-socket/intelij-dependencies.webp) _build.gradle_

ì´ ì²˜ëŸ¼ build.gradleì— ìœ„ ì„¸ ê°€ì§€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•´ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.

<p>
  <img
    src="/contents/tech/springboot-socket/gradle-download.webp"
    alt="gradle download"
    width="200px"
  />
  <em>gradle ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</em>
</p>

ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í–ˆë‹¤ë©´, ì´ì œ Spring Boot í”„ë¡œì íŠ¸ì™€ ì—°ê²°í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ì—°ê²°ì„ ìœ„í•´ ìš°ì„  Supabaseë¡œ ëŒì•„ê°€ ìƒë‹¨ì˜ Connect ë²„íŠ¼ì„ ëˆŒëŸ¬ì¤ë‹ˆë‹¤.

![Supabase Connect](/contents/tech/springboot-socket/db-connect.webp) _Supabase Connect_

Connect ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìœ„ì™€ ê°™ì€ í™”ë©´ì´ ëœ¨ëŠ”ë°, ì—¬ê¸°ì„œ Typeì„ JDBCë¡œ ì„¤ì •í•´ì¤ë‹ˆë‹¤. ê·¸ë¦¬ê³  Transaction poolerì˜ ì£¼ì†Œë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  application.propertiesì— ì•„ë˜ì™€ ê°™ì´ Database ì •ë³´ë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

> Database ì •ë³´ëŠ” ì¤‘ìš”í•˜ê¸° ë•Œë¬¸ì— Gitì„ ì‚¬ìš©í•˜ì‹œëŠ” ë¶„ë“¤ì€ gitignoreì— ì¶”ê°€í•´ì£¼ì„¸ìš”.

```java:application.properties
spring.application.name=ProjectName

spring.datasource.url=jdbc:postgresql://aws-0-ap-northeast-2.pooler.supabase.com:6543/postgres?user=<User>&password=<Password>
spring.datasource.username=postgres
spring.datasource.password=<Password>

spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.properties.hibernate.show_sql=true
spring.jpa.hibernate.ddl-auto=update
spring.session.jdbc.initialize-schema=always
```

![InteliJ Application Properties](/contents/tech/springboot-socket/intelij-properties.webp) _application.properties_

ì¶”ê°€ë¡œ InteliJ Ultimate ë²„ì „ì„ ì‚¬ìš©í•˜ì‹ ë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ InteliJì™€ Databaseë¥¼ ì—°ê²°í•´ì„œ Databaseë¥¼ ì‰½ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![InteliJ Ultimate](/contents/tech/springboot-socket/intelij-dbcheck.webp) _InteliJ Database ì—°ê²°_

## Member ê´€ë ¨ ê¸°ëŠ¥ ë§Œë“¤ê¸°

ìš°ì„  ì±„íŒ… ê¸°ëŠ¥ êµ¬í˜„ ì „ ì‚¬ìš©ìë“¤ ê°„ ì‹ë³„ì„ ìœ„í•´ Member í…Œì´ë¸”ì„ ìƒì„±í•œ ë’¤ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ ì£¼ê² ìŠµë‹ˆë‹¤.

![Member Class ìƒì„±](/contents/tech/springboot-socket/member-class.webp) _Member Class ìƒì„±_

ìœ„ì™€ ê°™ì´ Member Classë¥¼ ìƒì„±í•œ ë’¤ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•œë‹¤ë©´ Supabaseì— Member í…Œì´ë¸”ì´ ìƒì„±ë©ë‹ˆë‹¤.

![Supabase Member Table](/contents/tech/springboot-socket/db-member.webp) _Supabase Member Table_

ì´ì œ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ì£¼ê² ìŠµë‹ˆë‹¤.

> ì˜¤ëŠ˜ í”„ë¡œì íŠ¸ëŠ” ì†Œì¼“ ì´í•´ì— ì´ˆì ì„ ë‘ì—ˆê¸° ë•Œë¬¸ì— íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ ê¸°ëŠ¥ì˜ ì˜ˆì™¸ ì²˜ë¦¬ ë° í† í° ë°œí–‰ì€ ìƒëµí•˜ê³  ìœ ì €ë¥¼ ë‹¨ìˆœíˆ ìœ ì € ì´ë¦„ ê°’ìœ¼ë¡œ ì‹ë³„í•˜ê² ìŠµë‹ˆë‹¤.

p.s. ì˜†ì— ìˆë˜ ì¹œêµ¬ê°€ ë§ë„ ì•ˆë˜ëŠ” ì†Œë¦¬ë¼ê³  í•˜ì˜€ì§€ë§Œ ì œê°€ ê³ 3ì¸ ê´€ê³„ë¡œ ìˆ˜í–‰í‰ê°€ì— íˆ¬ìí•  ì‹œê°„ì´ ë§ì´ ì—†ê¸° ë•Œë¬¸ì— ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤. ğŸ˜¢

ìš°ì„  JPAë¥¼ ì‚¬ìš©í•˜ì—¬ CRUD ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ MemberRepositoryë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```java:MemberRepository.java
package com.pickle.socket.member;

import java.util.Optional;
import org.springframework.data.jpa.repository.JpaRepository;

public interface MemberRepository extends JpaRepository<Member, Long> {
    Optional<Member> findByUsername(String Username);
}
```

![Member Repository](/contents/tech/springboot-socket/intelij-memberrepo.webp) _Member Repository_

ê·¸ë¦¬ê³  BCryptPasswordEncoder ë° CSRF ë³´í˜¸ë¥¼ ë¹„í™œì„±í™” í•˜ê¸° ìœ„í•´ì„œ SecurityConfigë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```java:SecurityConfig.java
package com.pickle.socket;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf((csrf) -> csrf.disable());

        http.authorizeHttpRequests((authorize) ->
                authorize.requestMatchers("/**").permitAll()
        );

        return http.build();
    }
}
```

![Security Config](/contents/tech/springboot-socket/intelij-securityconfig.webp) _Security Config_

ì´ì œ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.

```java:MemberController.Java
package com.pickle.socket.member;

import lombok.RequiredArgsConstructor;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
@RequestMapping("member")
@RequiredArgsConstructor
public class MemberController {
    private final MemberRepository memberRepository;
    private final PasswordEncoder passwordEncoder;

    @PostMapping("/register")
    @ResponseBody
    String Register(String username, String password) {
        Member member = new Member();
        member.setUsername(username);
        member.setPassword(passwordEncoder.encode(password));
        memberRepository.save(member);
        return "success";
    }

    @PostMapping("login")
    @ResponseBody
    String Login(String username, String password) {
        var member = memberRepository.findByUsername(username).get();
        if(passwordEncoder.matches(password, member.getPassword())) {
            return member.getUsername();
        } else {
            return "fail";
        }
    }
}
```

![Member Controller](/contents/tech/springboot-socket/intelij-membercontroller.webp) _Member Controller_

Postmanìœ¼ë¡œ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ì„ ì‹œë„í•´ë³´ë©´ Tableì— ì˜ ì¶”ê°€ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![Postman Register](/contents/tech/springboot-socket/postman-register.webp) _Postman Register_

![Tableì— ì¶”ê°€ëœ Member](/contents/tech/springboot-socket/db-register.webp) _Tableì— ì¶”ê°€ëœ Member_

![Postman Login](/contents/tech/springboot-socket/postman-login.webp) _Postman Login_

## Member ê¸°ëŠ¥ ì ìš©í•˜ê¸°

ì´ì œ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë†“ì€ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì´ë™í•˜ì—¬ ì§€ê¸ˆê¹Œì§€ ë§Œë“¤ì—ˆë˜ Member ê´€ë ¨ ê¸°ëŠ¥ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

[í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ](https://github.com/pickle-team/front-socket)

í”„ë¡ íŠ¸ì—”ë“œëŠ” vite ê¸°ë°˜ Reactë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤. ìš°ì„  CORS ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ vite.config.jsì— proxyë¥¼ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

```javascript:vite.config.js
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      "/api": {
        target: "http://localhost:8080",
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, ""),
      },
    },
  },
});
```

ê·¸ë¦¬ê³  Loginê³¼ Register ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸° ì „ ë‹¤ì‹œ í•œë²ˆ í˜„ì¬ í”„ë¡œì íŠ¸ì˜ í”Œë¡œìš°ë¥¼ í™•ì¸í•´ë³´ìë©´,

ìš°ì„  Registerì˜ ê²½ìš° í”„ë¡ íŠ¸ì—”ë“œì—ì„œ Sign Up ëª¨ë‹¬ì—ì„œ Usernameê³¼ Passwordë¥¼ ì…ë ¥ë°›ì•„ MemberControllerì˜ Registerë¡œ ìš”ì²­ì„ ë³´ë‚´ê³ , Registerì—ì„œëŠ” MemberRepositoryë¥¼ í†µí•´ Member Tableì— Usernameê³¼ Passwordë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  Loginì˜ ê²½ìš° Sign In ëª¨ë‹¬ì—ì„œ Usernameê³¼ Passwordë¥¼ ì…ë ¥ë°›ì•„ MemberControllerì˜ Loginìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ê³ , Loginì—ì„œëŠ” MemberRepositoryë¥¼ í†µí•´ Member Tableì—ì„œ Usernameì„ ì°¾ì•„ Passwordë¥¼ ë¹„êµí•˜ì—¬ ì¼ì¹˜í•˜ë©´ Usernameì„ ë°˜í™˜í•©ë‹ˆë‹¤. ë°˜í™˜í•œ Usernameì€ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ Cookieì— ì €ì¥ë˜ë©° ì´ëŠ” ì‚¬ìš©ì êµ¬ë³„ì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. (ë‹¤ì‹œ í•œ ë²ˆ ê°•ì¡°í•˜ì§€ë§Œ ì €ëŠ” ê³ 3ì´ê¸° ë•Œë¬¸ì— ë„˜ì–´ê°€ëŠ” ê²ƒì´ì§€ ì—¬ëŸ¬ë¶„ì€ í† í° ë°œí–‰ì„ ì² ì €í•˜ê²Œ í•´ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤.)

### Register

![Frontend Register](/contents/tech/springboot-socket/fe-register.webp) _Frontend Register_

![Frontend Register Response Ok](/contents/tech/springboot-socket/fe-registerok.webp) _Frontend Register Response Ok_

![Supabase Register Response Ok](/contents/tech/springboot-socket/db-registerok.webp) _Supabase Register Response Ok_

### Login

![Frontend Register Response Ok](/contents/tech/springboot-socket/fe-signin.webp) _Frontend Login_

![Supabase Register Response Ok](/contents/tech/springboot-socket/fe-signinok.webp) _Frontend Login Reponse Ok_

## Chat ê¸°ëŠ¥ ë§Œë“¤ê¸°

Socketì„ ì ìš©í•˜ê¸° ì „ì—, ìš°ì„  ì‚¬ìš©ìê°€ ë©”ì„¸ì§€ë¥¼ ë³´ë‚´ë©´ ìƒëŒ€ë°©ì´ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ê°„ë‹¨í•œ ë¡œì§ì„ ë§Œë“¤ì–´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

### Socket ì ìš© ì „

```java:ChatController.java
package com.pickle.socket.chat;

import java.util.List;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

@Controller
@RequestMapping("chat")
@RequiredArgsConstructor
public class ChatController {
    private final ChatRepository chatRepository;

    @GetMapping("{room}")
    @ResponseBody
    public List<Chat> getChatsByRoom(@PathVariable Long room) {
        return chatRepository.findByRoomOrderByTimestampDesc(room);
    }

    @PostMapping("post")
    @ResponseBody
    public Chat NewChat(@RequestBody Chat chat) {
        return chatRepository.save(chat);
    }
}
```

ìœ„ ì½”ë“œëŠ” `/chat/[ë°© ID]`ì— ìš”ì²­í•˜ë©´ ë°© IDì— í•´ë‹¹í•˜ëŠ” ì±„íŒ…ì„ Listë¡œ ë°˜í™˜í•´ì£¼ê³ , `/chat/post`ì— ìš”ì²­í•˜ë©´ ì‚¬ìš©ìê°€ ë³´ë‚¸ ì±„íŒ…ì„ DBì— ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” `/chat/post`ë¡œ POST ìš”ì²­ì„ ë³´ë‚´ëŠ” client ì½”ë“œì…ë‹ˆë‹¤.

```tsx
 try {
      const username = getCookie("username");

      if (!username) {
        alert("You must be logged in to send messages");
        return;
      }

      const time = new Date().toISOString();

      const response = await fetch("/api/chat/post", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          room: id,
          username,
          content,
          timestamp: time,
        }),
      });

      if (response.ok) {
        setContent("");
        fetchMessages();
      } else {
        alert("Failed to send message");
      }
    } catch (error) {
      console.error("Error sending message:", error);
      alert("An error occurred while sending your message");
    }
  };
```

ì´ëŸ°ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•  ê²½ìš° ì±„íŒ…ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ì‹¤ì‹œê°„ ì†Œí†µì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.

![not socket](/contents/tech/springboot-socket/not-socket.gif) _Socketì„ ì ìš©í•˜ì§€ ì•Šì€ ê²½ìš°_

### Socket ì ìš©

ìœ„ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ Socketì„ ì‚¬ìš©í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ìš°ì„  build.gradleì— Socketì„ ì¶”ê°€í•œ ë’¤ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```java
implementation 'org.springframework.boot:spring-boot-starter-websocket'
```

ê·¸ë¦¬ê³  ì±„íŒ… ë©”ì„¸ì§€ DTOë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.

```java:ChatMessage.java
package com.pickle.socket.chat;

import java.time.LocalDateTime;
import lombok.Getter;
import lombok.Setter;
import lombok.ToString;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;

@Getter
@Setter
@ToString
@AllArgsConstructor
@NoArgsConstructor
public class ChatMessage {
    private String username;
    private Long room;
    private String content;
    private LocalDateTime timestamp;

    public Chat toEntity() {
        Chat chat = new Chat();
        chat.setUsername(this.username);
        chat.setRoom(this.room);
        chat.setContent(this.content);
        chat.setTimestamp(this.timestamp != null ? this.timestamp : LocalDateTime.now());
        return chat;
    }
}
```

ê·¸ë¦¬ê³  Socket Controllerë¥¼ ë§Œë“¤ì–´ Socketìœ¼ë¡œ ë©”ì„¸ì§€ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

```java:ChatWebSocketController.javapackage
com.pickle.socket.chat;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.messaging.handler.annotation.MessageMapping;
import org.springframework.messaging.handler.annotation.Payload;
import org.springframework.messaging.simp.SimpMessageSendingOperations;
import org.springframework.stereotype.Controller;

import java.time.LocalDateTime;

@Slf4j
@Controller
@RequiredArgsConstructor
public class ChatWebSocketController {

    private final SimpMessageSendingOperations messagingTemplate;
    private final ChatRepository chatRepository;

    @MessageMapping("/chat.sendMessage")
    public void sendMessage(@Payload ChatMessage chatMessage) {
        log.info("Received message: {}", chatMessage);

        if (chatMessage.getTimestamp() == null) {
            chatMessage.setTimestamp(LocalDateTime.now());
        }

        Chat savedChat = chatRepository.save(chatMessage.toEntity());

        messagingTemplate.convertAndSend(
            "/topic/chat." + chatMessage.getRoom(),
            savedChat
        );
    }
}
```

ì´í›„ WebSocketConfigë¥¼ ì„¤ì •í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì™€ ì‹¤ì‹œê°„ í†µì‹ ì„ ê°€ëŠ¥í•˜ë„ë¡ í•©ë‹ˆë‹¤.

```java:WebSocketConfig.java
package com.pickle.socket.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.messaging.simp.config.MessageBrokerRegistry;
import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;
import org.springframework.web.socket.config.annotation.StompEndpointRegistry;
import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;

@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    @Override
    public void configureMessageBroker(MessageBrokerRegistry config) {
        config.enableSimpleBroker("/topic");

        config.setApplicationDestinationPrefixes("/app");
    }

    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint("/ws")
                .setAllowedOriginPatterns("*")
                .withSockJS();
    }
}
```

ì¶”ê°€ë¡œ SessionConfigë¥¼ ì¶”ê°€í•˜ì—¬ PostgreSQLì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œë¥¼ ì˜ˆë°©í•©ë‹ˆë‹¤.

```java:SessionConfig.java
package com.pickle.socket.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.jdbc.support.lob.DefaultLobHandler;
import org.springframework.jdbc.support.lob.LobHandler;
import org.springframework.session.jdbc.config.annotation.web.http.EnableJdbcHttpSession;
import org.springframework.transaction.annotation.EnableTransactionManagement;

@Configuration
@EnableJdbcHttpSession
@EnableTransactionManagement
public class SessionConfig {

    @Bean
    public LobHandler lobHandler() {
        return new DefaultLobHandler();
    }
}
```

ì´ì œ í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì£¼ê² ìŠµë‹ˆë‹¤. ìš°ì„  Stomp.jsì™€ Sock.jsë¥¼ ì„¤ì¹˜í•˜ì—¬ WebSocket ì—°ë™ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.

```bash
pnpm add @stomp/stompjs sockjs-client
```

ê·¸ë¦¬ê³  vite.config.jsì— WebSocketê³¼ ê´€ë ¨ëœ í”„ë¡ì‹œë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

```js:vite.config.js
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import { fileURLToPath, URL } from "node:url";

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": fileURLToPath(new URL("./src", import.meta.url)),
    },
  },
  define: {
    global: "window",
  },
  server: {
    proxy: {
      "/api": {
        target: "http://localhost:8080",
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, ""),
      },
      "/ws": {
        target: "http://localhost:8080",
        ws: true,
      },
    },
  },
});
```

ê·¸ë¦¬ê³  global ê°ì²´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì•„ë˜ì˜ ì½”ë“œë¥¼ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

```ts:polyfills.ts
window.global = window;
```

```ts:global.d.ts
interface Window {
  global: Window;
}
```

ì´í›„ Socket ì‚¬ìš©ì„ ìœ„í•´ WebSocketServiceë¥¼ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.

```ts:WebSocketService.ts
import { Client, IMessage } from "@stomp/stompjs";
import SockJS from "sockjs-client";

export type MessageHandler<T = unknown> = (message: T) => void;

class WebSocketService {
  private client: Client | null = null;
  private handlers: Map<string, MessageHandler<unknown>[]> = new Map();

  connect(): Promise<void> {
    return new Promise((resolve, reject) => {
      this.client = new Client({
        webSocketFactory: () => new SockJS("/ws"),
        onConnect: () => {
          console.log("WebSocket ì—°ê²° ì„±ê³µ!");
          resolve();
        },
        onStompError: (frame) => {
          console.error("WebSocket ì—ëŸ¬: ", frame);
          reject(frame);
        },
        onDisconnect: () => {
          console.log("WebSocket ì—°ê²° ì¢…ë£Œ");
        },
      });

      this.client.activate();
    });
  }

  disconnect() {
    if (this.client && this.client.connected) {
      this.client.deactivate();
    }
  }

  subscribe<T = unknown>(topic: string, callback: MessageHandler<T>) {
    if (!this.client || !this.client.connected) {
      console.error("WebSocketì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
      return;
    }

    if (!this.handlers.has(topic)) {
      this.handlers.set(topic, []);
      this.client.subscribe(topic, (message: IMessage) => {
        try {
          const parsedBody = JSON.parse(message.body);
          const handlers = this.handlers.get(topic) || [];
          handlers.forEach((handler) => handler(parsedBody));
        } catch (error) {
          console.error("ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
        }
      });
    }

    const handlers = this.handlers.get(topic) || [];
    handlers.push(callback as MessageHandler<unknown>);
    this.handlers.set(topic, handlers);
  }

  unsubscribe(topic: string, callback?: MessageHandler<unknown>) {
    if (!this.handlers.has(topic)) {
      return;
    }

    if (callback) {
      const handlers = this.handlers.get(topic) || [];
      const updatedHandlers = handlers.filter(
        (handler) => handler !== callback
      );
      this.handlers.set(topic, updatedHandlers);
    } else {
      this.handlers.delete(topic);
    }
  }

  send(destination: string, body: Record<string, unknown>) {
    if (!this.client || !this.client.connected) {
      console.error("WebSocketì´ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
      return;
    }

    this.client.publish({
      destination,
      body: JSON.stringify(body),
    });
  }
}

export default new WebSocketService();
```

ì´í›„ WebSocketì„ ì‚¬ìš©í•œ ìš”ì²­ìœ¼ë¡œ ì½”ë“œë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.

```tsx:Chat.tsx
import { Box, Button, Flex, Heading, Text, TextArea } from "@radix-ui/themes";
import { useParams } from "react-router";
import { useEffect, useState } from "react";
import WebSocketService from "../services/WebSocketService";

interface ChatMessage {
  id: number;
  username: string;
  content: string;
  room: number;
  timestamp: string;
}

export default function Chat() {
  const { id } = useParams();
  const [content, setContent] = useState("");
  const [username, setUsername] = useState("");
  const [messages, setMessages] = useState<ChatMessage[]>([]);
  const [connected, setConnected] = useState(false);

  const getCookie = (name: string) => {
    const cookieValue = document.cookie
      .split("; ")
      .find((row) => row.startsWith(`${name}=`))
      ?.split("=")[1];

    return cookieValue || "";
  };

  const fetchMessages = async () => {
    try {
      const response = await fetch(`/api/chat/${id}`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
        },
      });

      if (response.ok) {
        const data = await response.json();
        console.log("Fetched messages:", data);
        setMessages(data);
      } else {
        console.error("Failed to fetch messages:", response.status);
      }
    } catch (error) {
      console.error("Error fetching messages:", error);
    }
  };

  const setupWebSocket = async () => {
    try {
      await WebSocketService.connect();
      setConnected(true);

      WebSocketService.subscribe(
        `/topic/chat.${id}`,
        (message: ChatMessage) => {
          setMessages((prevMessages) => [message, ...prevMessages]);
        }
      );
    } catch (error) {
      console.error("WebSocket ì—°ê²° ì‹¤íŒ¨:", error);
    }
  };

  useEffect(() => {
    const usernameFromCookie = getCookie("username");
    if (usernameFromCookie) {
      setUsername(usernameFromCookie);
    }

    fetchMessages();

    setupWebSocket();

    return () => {
      WebSocketService.disconnect();
    };
  }, [id]);

  const handleSendMessage = async () => {
    if (!username || !content.trim()) {
      return;
    }

    if (!connected) {
      alert("ì„œë²„ì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”.");
      return;
    }

    const chatMessage = {
      username,
      content,
      room: Number(id),
      timestamp: new Date().toISOString(),
    };

    WebSocketService.send("/app/chat.sendMessage", chatMessage);

    setContent("");
  };

  return (
    <Flex height="100vh" direction="column" align="center" justify="center">
      <Flex width="300px" direction="column" align="center" justify="center">
        <Heading size="7">Chatting {id}</Heading>
        <Box height="16px" />
        <Text>{username}ë¡œ ë¡œê·¸ì¸ ë¨</Text>
        <Box height="16px" />
        <Flex
          width="100%"
          height="400px"
          direction="column-reverse"
          overflowY="scroll"
          style={{
            borderRadius: "12px",
            padding: "12px",
            border: "1px solid #d4d4d4",
          }}
        >
          {messages.length > 0 ? (
            messages.map((msg, index) => (
              <Box
                key={index}
                style={{
                  marginBottom: "8px",
                  alignSelf:
                    msg.username === username ? "flex-end" : "flex-start",
                  backgroundColor:
                    msg.username === username ? "#e3f2fd" : "#f5f5f5",
                  padding: "8px 12px",
                  borderRadius: "12px",
                  maxWidth: "80%",
                }}
              >
                <Text size="2" weight="bold">
                  {msg.username + " "}
                </Text>
                <Text>{msg.content}</Text>
              </Box>
            ))
          ) : (
            <Text>No messages yet</Text>
          )}
        </Flex>
        <Box height="16px" />
        <TextArea
          style={{ width: "100%" }}
          placeholder="ë©”ì„¸ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”."
          value={content}
          onChange={(e) => setContent(e.target.value)}
          onKeyDown={(e) => {
            if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              handleSendMessage();
            }
          }}
        />
        <Box height="16px" />
        <Button
          style={{ width: "100%" }}
          color="purple"
          onClick={handleSendMessage}
        >
          ì „ì†¡
        </Button>
      </Flex>
    </Flex>
  );
}
```

ê·¸ë¦¬ê³  ì„œë²„ë¥¼ ì¬ì‹¤í–‰í•©ë‹ˆë‹¤.

![apply socket](/contents/tech/springboot-socket/apply-socket.gif) _Socketì„ ì ìš©í•œ ê²½ìš°_

ê·¸ë ‡ë‹¤ë©´ ìœ„ì™€ ê°™ì´ ì‹¤ì‹œê°„ ì†Œí†µì´ ê°€ëŠ¥í•œ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë” ìì„¸í•œ ì½”ë“œëŠ” GitHubë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤.

- [GitHub - pickle-team/chat-socket](https://github.com/pickle-team/chat-socket)
- [GitHub - pickle-team/front-socket](https://github.com/pickle-team/front-socket)
